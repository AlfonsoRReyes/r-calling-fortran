---
title: "R Notebook"
output: html_notebook
---

```{r}
ffile <- "A_E1"
# delete existing files first
if (file.exists("A_E1.o"))   file.remove("A_E1.o")
if (file.exists("A_E1.dll")) file.remove("A_E1.dll")
if (file.exists("A_E1.so"))  file.remove("A_E1.so")

# now, compile
system("R CMD SHLIB A_E1.f")
```


```{r}
# this loads the library in any system, Windows or Linux
dyn.load(paste("A_E1", .Platform$dynlib.ext, sep = ""))
```


## Test the function
We call this function with:
```{r}
EI <- function(x) {
  # R function that calls the Fortran function `fib` through
  # a Fortran wrapper.
  out <- .Fortran('A_E1_SUB',         # `out` is a list and returns the result
                  n = as.double(x),       # and the parameter that were passed.
                  result = as.double(1))
  return(out$result)             
}

# call the R function wrapper
EI(12)    
```

```{r}
x <- seq(0, 2.5, 0.01)
Ei <- sapply(x, EI)
Eu <- sapply(x, function(x) log(1/(exp(0.577216)*x)))
df <- data.frame(x, Ei, Eu)
df
```

```{r fig.asp=1}
library(ggplot2)

ggplot(df, aes(x = x, y = Ei)) + geom_line(col="blue") + 
  geom_line(aes(x=x, y=Eu), linetype = "dotted") + ylab("Ei(x)") +
  annotate("text", x = 1, y = 1.1, label = "problem 1", angle=0, size=4, 
                colour='black', fontface = "bold") +
  annotate("text", x = 2, y = 1, parse = TRUE, 
           label = "frac(1, sqrt(2 * pi)) * e ^ {-x^2 / 2}") +
    geom_segment(aes(x = 1, y = 1, 
                   xend = 0.75, yend = 0.35), 
               colour='#CC00FF', 
               size=0.5,  
               arrow = arrow(length = unit(0.5, "cm")))
```


## Unload the Fortran subroutine. Generic OS
```{r}
dyn.unload(paste("A_E1", .Platform$dynlib.ext, sep = ""))
```

```{r}
library(ggplot2)
library(grid)

ggplot(df, aes(Date, CPU)) + geom_point() + 
       annotate("text", x = as.POSIXct(c("2013-03-11 23:00:00")), 
                y = 90, label = "problem 1", angle=90, size=5, 
                colour='black', face="bold") + 
  geom_segment(aes(x = as.POSIXct(c("2013-03-11 09:00:00")), 
                                   y = -30, 
                   xend = as.POSIXct(c("2013-03-11 09:00:00")), 
                   yend = 0), 
               colour='#CC00FF', 
               size=1,  
               arrow = arrow(length = unit(0.5, "cm")))
```

